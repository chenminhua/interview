## redis 支持哪几种数据类型？

string，一个键可以存 512M 数据
list, 一个简单的字符串列表，按照插入顺序排序
set, 是通过哈希表实现的，所以添加、删除、查找的复杂度都是 O(1)。
zset, 和 set 相比每个元素多了个关联的分数
hash, 特别适合用于存储对象

## redis 有哪几种持久化？优缺点是什么？

RDB 方式(默认)： rdbsave 和 rdbload 两个命令
AOF RDB 方式： 每当执行服务器定时任务或者函数时调用 flushAppendOnlyFile 函数，将数据写入文件。

## redis 突然挂了，内存里面的数据怎么办？

redis 提供了两种解决方案，第一种是时间点转储，转储操作既可以为"在指定时间段内有指定数量的写操作时执行"，也可以执行转储到硬盘的命令来执行。第二种持久化则是将所有修改了数据库的命令都写入一个 append-only 的文件里面。我们可以设置为*从不同步，每秒同步一次或者每写入一个命令同步一次*。redis 也支持主从服务器的设置，来避免对主服务器的集中访问。

## redis 有哪些架构模式？

单机模式

主从复制模式：一主多从，redis 的 replication 允许用户根据一个 redis 服务器来创建任意多个复制服务器。但是主从复制模式没有解决 master 的写压力，也不能保证高可用。有哨兵可以做监控提醒，并完成自动 failover。

proxy 模式：可以有多个主，但是在 redis 外面加了个代理，客户端只与代理通信，比如 twemproxy。

集群模式：3.0 之后支持集群模式。不保证强一致性。

## 如何提升 redis 的读写性能？

## 如何使用 redis 实现分布式锁？

先拿 setnx 来争抢锁，抢到之后，再用 expire 给锁加一个过期时间防止锁忘记了释放。
如果在 setnx 之后执行 expire 之前进程意外 crash 或者要重启维护了，那会怎么样？
set 指令有非常复杂的参数，这个应该是可以同时把 setnx 和 expire 合成一条指令来用的！

## 如何使用 redis 做异步队列？有什么缺点？

一般使用 list 结构作为队列，rpush 生产消息，lpop 消费消息。当 lpop 没有消息的时候，要适当 sleep 一会再重试。
缺点：
在消费者下线的情况下，生产的消息会丢失，得使用专业的消息队列如 rabbitmq 等。
能不能生产一次消费多次呢？
使用 pub/sub 主题订阅者模式，可以实现 1:N 的消息队列。

## 什么是缓存穿透？如何避免？

一般的缓存系统，都是按照 key 去缓存查询，如果不存在对应的 value，就应该去后端系统查找（比如 DB）。一些恶意的请求会故意查询不存在的 key,请求量很大，就会对后端系统造成很大的压力。这就叫做缓存穿透。
如何避免？
1：对查询结果为空的情况也进行缓存，缓存时间设置短一点，或者该 key 对应的数据 insert 了之后清理缓存。
2：对一定不存在的 key 进行过滤。可以把所有的可能存在的 key 放到一个大的 Bitmap 中，查询时通过该 bitmap 过滤。

## 什么是缓存雪崩？如何避免？

当缓存服务器重启或者大量缓存集中在某一个时间段失效，这样在失效的时候，会给后端系统带来很大压力。导致系统崩溃。

1：在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个 key 只允许一个线程查询数据和写缓存，其他线程等待。
2：做二级缓存，A1 为原始缓存，A2 为拷贝缓存，A1 失效时，可以访问 A2，A1 缓存失效时间设置为短期，A2 设置为长期
3：不同的 key，设置不同的过期时间，让缓存失效的时间点尽量均匀
